<!--
  Este script manipula o player do youtube e envia ao mautic os plays e tambem
  informa se o lead assistiu o video até o fim
-->
<iframe id="player" src="https://www.youtube.com/embed/NpEaa2P7qZI?enablejsapi=1"></iframe>
<script>
  // este é o manipulador do video
  var player;
  // coloque aqui o URL do seu Mautic
  var mauticUrl = "https://mkt.site.com";

  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      events: {
        'onStateChange': onPlayerStateChange
      }
    });
  }
  function onPlayerStateChange(event) {
    var videoid = player.getVideoData()['video_id'];
    var video_tag = 'youtube_' + videoid;
    var video_end_tag = video_tag + "_end";
    switch (event.data) {
      case 0: // aqui é o fim do video
        tracking = new Image();
        tracking.src = mauticUrl + '/mtracking.gif?tags=' + video_tag + ',' + video_end_tag;
        document.body.appendChild(tracking);
        break;
      case 1: // aqui é o evento play
        tracking = new Image();
        tracking.src = mauticUrl + '/mtracking.gif?tags=' + video_tag;
        document.body.appendChild(tracking);
    }
  }
</script>
<script src="https://www.youtube.com/iframe_api"></script>
